# PEG Parser

I currently don't have any plan to build a new PEG Parser from scratch, this folder applies CPython's well-written PEG parser.

CPython PEG parser generator (a.k.a. pegen) allows to generate both C and Python Packrat parsers. This package contains both grammar for C and Python and the generated parsers.

To repeat the step to generate the parser by yourself, you can follow the steps in `run.sh`.

## Source Code Tracing

Let's dive deep into the customized C grammar in below (You can find the original grammar in [`Grammar/python.gram`](https://github.com/python/cpython/blob/master/Grammar/python.gram):

```
sum[expr_ty]:
    | a=sum '+' b=term { _Py_BinOp(a, Add, b, EXTRA) }
    | a=sum '-' b=term { _Py_BinOp(a, Sub, b, EXTRA) }
    | term
term[expr_ty]:
    | a=term '*' b=NUMBER { _Py_BinOp(a, Mult, b, EXTRA) }
    | a=term '/' b=NUMBER { _Py_BinOp(a, FloorDiv, b, EXTRA) }
    | NUMBER
```

- The grammar is written in following format: `non_terminal_symb[return_type]: re_rule_1 { action_1 } | re_rule_2 { action_2 }`

- `NUMBER` is defined in [Tokens](https://github.com/python/cpython/blob/master/Grammar/Tokens#L3), you can also run the code below in python interpreter to check the meaning behind Tokens

```
>>> import token
>>> token.NUMBER
```

- return type `expr_ty` is a struct defined in [Python-ast.h](https://github.com/python/cpython/blob/5cf4782a2630629d0978bf4cf6b6340365f449b2/Include/Python-ast.h#L18)

- action `_Py_BinOp` is defined in [Python-ast.h](https://github.com/python/cpython/blob/5cf4782a2630629d0978bf4cf6b6340365f449b2/Include/Python-ast.h#L654-L657)

- **parser.c** is generated by [Tools/peg_generator](https://github.com/python/cpython/blob/58fb156edda1a0e924a38bfed494bd06cb09c9a3/Tools/peg_generator)

- **Python-ast.h** is generated by [Parser/asdl_c.py](https://github.com/python/cpython/blob/366dc3a1354078e38808b9c16276e97cca5b8aaf/Parser/asdl_c.py)
